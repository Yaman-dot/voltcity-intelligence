<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VoltCity | Driver</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="top-nav">
        <div class="logo"><i class="fa-solid fa-bolt"></i> VoltCity DRIVER</div>
        <a href="/" class="nav-link">Back to Hub</a>
    </nav>

    <main class="dashboard-content">
        <section class="panel input-panel">
            <h2><i class="fa-solid fa-sliders"></i> Prediction Inputs</h2>
            <form action="/predict" method="POST">
                
                <h3 style="margin-top: 0; color: #00d4ff;"><i class="fa-solid fa-user-gear"></i> User Preferences</h3>
                <div class="form-group">
                    <label>Urgency Level: <span id="urgency-val" style="color:#00d4ff; font-weight:bold;">5</span>/10</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span style="font-size: 0.8rem; color: #888;">Low</span>
                        <input type="range" id="urgency" name="urgency" min="0" max="10" value="5" oninput="updateSliders()" style="flex-grow: 1;">
                        <span style="font-size: 0.8rem; color: #888;">High</span>
                    </div>
                </div>

                <div class="form-group" style="margin-bottom: 30px; border-bottom: 1px solid #444; padding-bottom: 20px;">
                    <label>Budget Sensitivity: <span id="budget-val" style="color:#00d4ff; font-weight:bold;">5</span>/10</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span style="font-size: 0.8rem; color: #888;">Low</span>
                        <input type="range" id="budget" name="budget" min="0" max="10" value="5" oninput="updateSliders()" style="flex-grow: 1;">
                        <span style="font-size: 0.8rem; color: #888;">High</span>
                    </div>
                </div>
                <h3>Vehicle & Location</h3>
                <div class="form-group">
                    <label for="vehicle">Vehicle Model</label>
                    <select id="vehicle" name="vehicle">
                        <option value="Tesla Model 3">Tesla Model 3</option>
                        <option value="Nissan Leaf">Nissan Leaf</option>
                        <option value="BMW i3">BMW i3</option>
                        <option value="Chevy Bolt">Chevy Bolt</option>
                        <option value="Hyundai Kona">Hyundai Kona</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="location">Location</label>
                    <select id="location" name="location">
                        <option value="Chicago">Chicago</option>
                        <option value="Houston">Houston</option>
                        <option value="Los Angeles">Los Angeles</option>
                        <option value="New York">New York</option>
                        <option value="San Francisco">San Francisco</option>
                    </select>
                </div>

                <h3>Session Details</h3>
                <div class="form-row" style="display: flex; gap: 15px;">
                    <div class="form-group" style="flex: 1;">
                        <label for="energy">Energy Needed (kWh)</label>
                        <input type="number" step="0.1" id="energy" name="energy" value="45.5" required>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Charging Rate (kW)</label>
                        <input type="number" step="0.1" id="charge_rate" name="charge_rate" value="7.2" required>
                    </div>
                </div>

                <div class="form-row" style="display: flex; gap: 15px;">
                    <div class="form-group" style="flex: 1;">
                        <label>Time of Day</label>
                        <select id = "time_day" name="time_day">
                            <option value="2">Morning</option>
                            <option value="0" selected>Afternoon</option>
                            <option value="1">Evening</option>
                            <option value="3">Night</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Day of Week</label>
                        <select id = "day_week" name="day_week">
                            <option value="1">Monday</option>
                            <option value="5">Tuesday</option>
                            <option value="6" selected>Wednesday</option>
                            <option value="4">Thursday</option>
                            <option value="0">Friday</option>
                            <option value="2">Saturday</option>
                            <option value="3">Sunday</option>
                        </select>
                    </div>
                </div>

                <h3>Battery & Condition</h3>
                <div class="form-group">
                    <label for="battery_cap">Battery Capacity (kWh)</label>
                    <input type="number" id="battery_cap" name="battery_cap" value="75">
                </div>

                <div class="form-row" style="display: flex; gap: 15px;">
                    <div class="form-group" style="flex: 1;">
                        <label>Start SoC (%)</label>
                        <input type="number" id = "start_soc" name="start_soc" value="20" min="0" max="100">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Distance Driven (km)</label>
                        <input type="number" id="dist_driven" name="dist_driven" value="50">
                    </div>
                </div>

                <div class="form-row" style="display: flex; gap: 15px;">
                    <div class="form-group" style="flex: 1;">
                        <label>Temperature (Â°C)</label>
                        <input type="number" id="temp" name="temp" value="25">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Vehicle Age (Years)</label>
                        <input type="number" step="1" id="age" name="age" value="2">
                    </div>
                </div>

                <h3>Profile Type</h3>
                <div class="form-row" style="display: flex; gap: 15px;">
                    <div class="form-group" style="flex: 1;">
                        <label>Charger Type</label>
                        <select id="charger_type" name="charger_type">
                            <option value="1">Level 1</option>
                            <option value="2" selected>Level 2</option>
                            <option value="0">DC Fast Charging</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>User Type</label>
                        <select id="user_type" name="user_type">
                            <option value="1">Commuter</option>
                            <option value="2" selected>Long-Distance Traveler</option>
                            <option value="0">Casual Driver</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="btn-main" style="margin-top: 20px; width: 100%;">Get Prediction</button>
            </form>
        </section>

        <section class="panel output-panel" style="font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; color: #e0e0e0; line-height: 1.6;">
    {% if prediction %}
    <div class="result-grid">
        <div class="card" style="padding: 20px; max-width: 500px; margin: 0 auto;">
            
            <h3 style="text-align: center; color: #aaa; text-transform: uppercase; font-size: 0.9rem; letter-spacing: 1px; margin-top: 0;">Results</h3>
            
            <div style="text-align:center; margin-bottom: 25px; margin-top: 15px;">
                <span style="display: inline-block; background:#333; padding: 8px 20px; border-radius: 20px; color:#00d4ff; font-weight:bold; text-transform:uppercase; font-size:0.85rem; letter-spacing: 0.5px;">
                    {{ strategy }} Strategy
                </span>
            </div>

            <div style="text-align: center; margin-bottom: 30px;">
                <h1 style="font-size: 4rem; margin: 0; line-height: 1; font-weight: 700; color: #fff;">{{ comfort_score }}</h1>
                <span style="color: #aaa; font-size: 0.85rem; text-transform: uppercase; font-weight: 600; display: block; margin-top: 5px;">Comfort Score</span>
            </div>

            <div class="stat-box" style="display: flex; justify-content: center; gap: 40px; margin-bottom: 30px; padding: 15px 0; border-top: 1px solid rgba(255,255,255,0.1); border-bottom: 1px solid rgba(255,255,255,0.1);">
                <div class="stat" style="text-align: center;">
                    <span class="label" style="display: block; font-size: 0.8rem; color: #aaa; text-transform: uppercase; margin-bottom: 5px;">Predicted Cost</span>
                    <span class="value" style="display: block; font-size: 1.5rem; font-weight: bold; color: #fff;">${{ cost }}</span>
                </div>
                <div class="stat" style="text-align: center;">
                    <span class="label" style="display: block; font-size: 0.8rem; color: #aaa; text-transform: uppercase; margin-bottom: 5px;">Time Diff</span>
                    <span class="value" style="display: block; font-size: 1.5rem; font-weight: bold; color: #fff;">{{ time }} <span style="font-size: 0.9rem; font-weight: normal; color: #999;">min</span></span>
                </div>
            </div>
            <div style="margin-bottom: 8px;">
                <span class="label" style="color: #00d4ff; font-weight: bold; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px;">AI Advice:</span>
            <div style="margin-bottom: 20px; padding: 18px; background: rgba(255,255,255,0.1); border-radius: 8px; font-style: italic; color: #ddd; display: flex; gap: 10px;">
                <i class="fa-solid fa-robot" style="margin-top: 4px; color: #aaa;"></i> 
                <span>"{{ advice_text }}"</span>
            </div>

            <div style="margin-bottom: 8px;">
                <span class="label" style="color: #00d4ff; font-weight: bold; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px;">To Minimize Cost You Should:</span>
            </div>

            <div style="margin-top: 0; padding: 18px; background: rgba(255,255,255,0.1); border-radius: 8px; font-style: italic; color: #ddd; display: flex; gap: 10px;">
                <i class="fa-solid fa-robot" style="margin-top: 4px; color: #aaa;"></i> 
                <span>"{{ recommendation_text }}"</span>
            </div>

            <div style="margin-top: 35px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 25px;">
                <h4 style="color: #00d4ff; text-align: center; margin-bottom: 25px; text-transform: uppercase; letter-spacing: 1px; font-size: 1rem;">
                    <i class="fa-solid fa-magnifying-glass-chart"></i> Transparency Report
                </h4>

                <div style="margin-bottom: 30px;">
                    <h5 style="color: #fff; border-left: 3px solid #00d4ff; padding-left: 10px; margin-bottom: 15px;">
                        Factors affecting <strong>COST</strong> ($)
                    </h5>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        
                        <div style="flex: 1; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; min-width: 200px;">
                            <span style="font-size: 0.75rem; color: #aaa; text-transform: uppercase; display: block; margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 5px;">LIME Analysis (Local)</span>
                            <ul style="padding-left: 20px; color: #ddd; font-size: 0.85rem; margin: 0;">
                                {% for msg in cost_lime %}
                                    <li style="margin-bottom: 6px;">{{ msg }}</li>
                                {% else %}
                                    <li style="color: #666;">No strong factors detected.</li>
                                {% endfor %}
                            </ul>
                        </div>

                        <div style="flex: 1; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; min-width: 200px;">
                            <span style="font-size: 0.75rem; color: #aaa; text-transform: uppercase; display: block; margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 5px;">SHAP Analysis (Global)</span>
                            <ul style="padding-left: 20px; color: #ddd; font-size: 0.85rem; margin: 0;">
                                {% for msg in cost_shap %}
                                    <li style="margin-bottom: 6px;">{{ msg }}</li>
                                {% else %}
                                    <li style="color: #666;">No strong factors detected.</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>

                <div>
                    <h5 style="color: #fff; border-left: 3px solid #00d4ff; padding-left: 10px; margin-bottom: 15px;">
                        Factors affecting <strong>TIME</strong> (min)
                    </h5>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        
                        <div style="flex: 1; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; min-width: 200px;">
                            <span style="font-size: 0.75rem; color: #aaa; text-transform: uppercase; display: block; margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 5px;">LIME Analysis (Local)</span>
                            <ul style="padding-left: 20px; color: #ddd; font-size: 0.85rem; margin: 0;">
                                {% for msg in time_lime %}
                                    <li style="margin-bottom: 6px;">{{ msg }}</li>
                                {% else %}
                                    <li style="color: #666;">No strong factors detected.</li>
                                {% endfor %}
                            </ul>
                        </div>

                        <div style="flex: 1; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; min-width: 200px;">
                            <span style="font-size: 0.75rem; color: #aaa; text-transform: uppercase; display: block; margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 5px;">SHAP Analysis (Global)</span>
                            <ul style="padding-left: 20px; color: #ddd; font-size: 0.85rem; margin: 0;">
                                {% for msg in time_shap %}
                                    <li style="margin-bottom: 6px;">{{ msg }}</li>
                                {% else %}
                                    <li style="color: #666;">No strong factors detected.</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    {% else %}
    <div class="placeholder-text" style="text-align: center; padding: 50px; color: #888;">
        <p style="font-size: 1.1rem;">Fill out the form to see AI predictions.</p>
    </div>
    {% endif %}
</section>
    </main>

    <script>
        function updateSliders() {
            document.getElementById('urgency-val').innerText = document.getElementById('urgency').value;
            document.getElementById('budget-val').innerText = document.getElementById('budget').value;
        }
    </script>
</body>
</html>